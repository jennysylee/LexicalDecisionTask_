<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lexical Decision Task (48 Trials)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffffff;
      color: #000000;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    #container {
      max-width: 800px;
      margin: 0 auto;
    }
    .hidden {
      display: none !important;
    }
    .stimulus {
      font-family: Arial, sans-serif;
      font-size: 40px;
      font-weight: bold;
      line-height: 1.2;
      min-height: 60px;
    }
    #fixation {
      font-size: 60px;
      margin: 20px 0;
    }
    #word1 { margin-bottom: 10px; }
    #word2 { margin-top: 10px; }
    #feedback {
      color: green;
      font-size: 32px;
    }
    #feedback.error {
      color: red;
    }
    button {
      margin: 10px;
      font-size: 18px;
      padding: 12px 24px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button:hover {
      background-color: #f0f0f0;
    }
    input {
      font-size: 18px;
      padding: 10px;
      text-align: center;
      width: 100px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #progress {
      font-size: 18px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="container">
    <!-- Participant ID screen -->
    <div id="start-screen">
      <h1>Lexical Decision Task (48 Trials)</h1>
      <p>Enter your 3-digit participant number (000â€“999):</p>
      <input type="text" id="participant-id" maxlength="3" pattern="[0-9]{3}">
      <br><br>
      <button id="start-btn">Start Experiment</button>
      <p id="id-error" class="error"></p>
    </div>

    <!-- Instructions -->
    <div id="instruction-screen" class="hidden">
      <h2>Instructions</h2>
      <p>48 trials: Fixation (+), then two words.</p>
      <p>A key if <strong>second</strong> is a real WORD | L key if NONWORD.</p>
      <p>Max 2s/trial. Respond fast & accurately!</p>
      <p>Press <strong>Spacebar</strong> to begin.</p>
    </div>

    <!-- Task display -->
    <div id="task-screen" class="hidden">
      <div id="progress"></div>
      <div id="fixation" class="stimulus"></div>
      <div id="word1" class="stimulus"></div>
      <div id="word2" class="stimulus"></div>
      <div id="feedback" class="stimulus"></div>
      <p style="font-size: 20px; margin-top: 20px;">
        <strong>Word: A</strong> | <strong>Nonword: L</strong>
      </p>
    </div>

    <!-- End screen -->
    <div id="end-screen" class="hidden">
      <h2>Complete! (48/48)</h2>
      <p>Download results or restart.</p>
      <div>
        <button id="download-btn">Download CSV</button>
        <button id="restart-btn">Restart (48 Trials)</button>
      </div>
      <p id="download-info"></p>
    </div>
  </div>

  <script>
    // 48-trial stimuli: 16 related (code 1), 16 unrelated (code 2), 16 nonword (code 3)
    // Sourced from Meyer/Schvaneveldt 1971 + standard norms[web:9][web:33]
    const trials = [
      // RELATED (1)
      {word1: "DOCTOR", word2: "NURSE", condition: "related", code: 1, correctKey: "a"},
      {word1: "BUTTER", word2: "BREAD", condition: "related", code: 1, correctKey: "a"},
      {word1: "NIGHT", word2: "DARK", condition: "related", code: 1, correctKey: "a"},
      {word1: "TABLE", word2: "CHAIR", condition: "related", code: 1, correctKey: "a"},
      {word1: "CAT", word2: "DOG", condition: "related", code: 1, correctKey: "a"},
      {word1: "KING", word2: "QUEEN", condition: "related", code: 1, correctKey: "a"},
      {word1: "FLOUR", word2: "BREAD", condition: "related", code: 1, correctKey: "a"},
      {word1: "COTTAGE", word2: "CHEESE", condition: "related", code: 1, correctKey: "a"},
      {word1: "PINE", word2: "TREE", condition: "related", code: 1, correctKey: "a"},
      {word1: "SALMON", word2: "FISH", condition: "related", code: 1, correctKey: "a"},
      {word1: "WHISKEY", word2: "VODKA", condition: "related", code: 1, correctKey: "a"},
      {word1: "HUNGRY", word2: "EAT", condition: "related", code: 1, correctKey: "a"},
      {word1: "SUMMER", word2: "HOT", condition: "related", code: 1, correctKey: "a"},
      {word1: "MONEY", word2: "CASH", condition: "related", code: 1, correctKey: "a"},
      {word1: "BLACK", word2: "WHITE", condition: "related", code: 1, correctKey: "a"},
      {word1: "COFFEE", word2: "TEA", condition: "related", code: 1, correctKey: "a"},

      // UNRELATED (2)
      {word1: "TREE", word2: "DOCTOR", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "BREAD", word2: "DOCTOR", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "NURSE", word2: "BUTTER", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "CHAIR", word2: "NIGHT", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "DOG", word2: "TABLE", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "QUEEN", word2: "CAT", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "FISH", word2: "KING", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "VODKA", word2: "FLOUR", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "CHEESE", word2: "COTTAGE", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "EAT", word2: "PINE", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "HOT", word2: "SALMON", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "CASH", word2: "WHISKEY", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "WHITE", word2: "HUNGRY", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "TEA", word2: "SUMMER", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "DARK", word2: "MONEY", condition: "unrelated", code: 2, correctKey: "a"},
      {word1: "BLACK", word2: "COFFEE", condition: "unrelated", code: 2, correctKey: "a"},

      // NONWORD (3)
      {word1: "DOCTOR", word2: "FLIPO", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "SOAM", word2: "GLOVE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "NART", word2: "TRIEF", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "PLAME", word2: "WINE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "BLINT", word2: "CRABLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "FROKE", word2: "SPLIM", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "QUINK", word2: "ZORBY", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "THRANG", word2: "WUMPLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "CLABBER", word2: "DINGLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "FLUNDER", word2: "GLOP", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "HISSOP", word2: "JANGLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "KLOPP", word2: "MIRKLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "NIMBLE", word2: "PLODDER", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "QUORBLE", word2: "RIMPLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "SPLORCH", word2: "TINGLE", condition: "nonword", code: 3, correctKey: "l"},
      {word1: "VLOBBER", word2: "WUNK", condition: "nonword", code: 3, correctKey: "l"}
    ];

    // State (same as before)
    let participantID = "";
    let currentTrialIndex = 0;
    let shuffledTrials = [];
    let trialStartTime = 0;
    let responseDeadline = 2000;
    let keyListenerActive = false;
    let results = [];
    let globalKeyHandler = null;
    const progressEl = document.getElementById("progress");

    // Elements (same)
    const screens = {
      start: document.getElementById("start-screen"),
      instructions: document.getElementById("instruction-screen"),
      task: document.getElementById("task-screen"),
      end: document.getElementById("end-screen")
    };
    const participantInput = document.getElementById("participant-id");
    const startBtn = document.getElementById("start-btn");
    const idError = document.getElementById("id-error");
    const fixationEl = document.getElementById("fixation");
    const word1El = document.getElementById("word1");
    const word2El = document.getElementById("word2");
    const feedbackEl = document.getElementById("feedback");
    const downloadBtn = document.getElementById("download-btn");
    const restartBtn = document.getElementById("restart-btn");
    const downloadInfo = document.getElementById("download-info");

    function showScreen(screenName) {
      Object.values(screens).forEach(s => s.classList.add("hidden"));
      screens[screenName].classList.remove("hidden");
    }

    function shuffleTrials() {
      shuffledTrials = [...trials].sort(() => Math.random() - 0.5);
    }

    function updateProgress() {
      progressEl.textContent = `Trial ${currentTrialIndex + 1}/48`;
    }

    function clearStimuli() {
      fixationEl.textContent = "";
      word1El.textContent = "";
      word2El.textContent = "";
      feedbackEl.textContent = "";
      feedbackEl.classList.remove("error");
      updateProgress();
    }

    // Rest of functions identical (validateID, startTaskHandler, nextTrial, keyResponse, endTrial, recordTrial, generateCSV)
    // ... [Omit for brevity; copy from previous version exactly, just replace trials with shuffledTrials in nextTrial/nextTrial calls]

    function nextTrial() {
      if (currentTrialIndex >= shuffledTrials.length) {
        showScreen("end");
        return;
      }
      clearStimuli();
      const trial = shuffledTrials[currentTrialIndex];
      // ... (fixation/timing/stimuli logic same, using trial)
    }

    function recordTrial(trial, key, rt, status) {
      results.push({
        participant: participantID,
        blockname: "main",
        tablerow: currentTrialIndex + 1,
        word1: trial.word1,
        word2: trial.word2,
        condition: trial.condition,
        code: trial.code,
        key: key || "",
        rt: rt ? Math.round(rt) : "",
        status
      });
    }

    // Event listeners (add shuffle in startTaskHandler)
    function startTaskHandler(e) {
      if (e.code !== "Space") return;
      shuffleTrials();  // NEW: Shuffle for each run
      showScreen("task");
      currentTrialIndex = 0;
      results = [];
      nextTrial();
    }

    // ... (all other code same as previous)

    // Auto-focus
    participantInput.focus();
  </script>
</body>
</html>

